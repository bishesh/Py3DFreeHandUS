<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Py3DFreeHandUS.segment &mdash; Py3DFreeHandUS 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Py3DFreeHandUS 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Py3DFreeHandUS 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for Py3DFreeHandUS.segment</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: segment</span>
<span class="sd">   :synopsis: helper module for image segmentation</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage.morphology</span> <span class="kn">import</span> <span class="n">binary_dilation</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Slider</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">RadioButtons</span>
<span class="kn">import</span> <span class="nn">tkFileDialog</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">cv2</span>


<div class="viewcode-block" id="detectHoughLongestLine"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.detectHoughLongestLine">[docs]</a><span class="k">def</span> <span class="nf">detectHoughLongestLine</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">thI</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">thCan1</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">thCan2</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">kerSizeCan</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">kerSizeDil</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">thHou</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">minLineLength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">maxLineGap</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a noisy gray-scale image containing 2 main blocks separated by a straight line, this function detects this line.</span>
<span class="sd">    The algorithm performs the following steps:</span>
<span class="sd">    </span>
<span class="sd">    1) Thresholding the input image</span>
<span class="sd">    2) Canny edge detector</span>
<span class="sd">    3) Dilation with a 1s-filled rectangular kernel</span>
<span class="sd">    4) Probabilistic Hough transform</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I : np.ndarray(uint8)</span>
<span class="sd">        The input image.</span>
<span class="sd">        </span>
<span class="sd">    thI : float</span>
<span class="sd">        Threshold relative to the maximum representative gray level. 0 &lt; thI &lt; 1.</span>
<span class="sd">        </span>
<span class="sd">    thCan1 : int</span>
<span class="sd">        Canny edge detector lower threshold.</span>
<span class="sd">    </span>
<span class="sd">    thCan2 : int</span>
<span class="sd">        Canny edge detector higher threshold.</span>
<span class="sd">        </span>
<span class="sd">    kerSizeCan : int</span>
<span class="sd">        Sobel kernel size for Canny edge detector. Either 3, 5, 7.</span>
<span class="sd">        </span>
<span class="sd">    kerSizeDil : list</span>
<span class="sd">        Rectangular kernel size (height, width) for dilation.</span>
<span class="sd">        </span>
<span class="sd">    thHou : int</span>
<span class="sd">        Threshold for Hough transform output matrix.</span>
<span class="sd">        </span>
<span class="sd">    minLineLength : int</span>
<span class="sd">        Minimum line length for probabilistic Hough transform.   </span>
<span class="sd">        </span>
<span class="sd">    maxLineGap : int</span>
<span class="sd">        Maximum line gap for probabilistic Hough transform.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a, b : float</span>
<span class="sd">        Slope and intercept of the line. If no line is detected, these are np.nan.</span>
<span class="sd">    </span>
<span class="sd">    bw : np.ndarray</span>
<span class="sd">        Image as result of point 1.</span>
<span class="sd">    </span>
<span class="sd">    edges : np.ndarray</span>
<span class="sd">        Image as result of point 2.</span>
<span class="sd">    </span>
<span class="sd">    dilate : np.ndarray</span>
<span class="sd">        Image as result of point 3.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c"># Threshold image</span>
    <span class="n">maxVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
    <span class="n">th</span><span class="p">,</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span><span class="n">I</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">thI</span><span class="o">*</span><span class="n">maxVal</span><span class="p">),</span><span class="n">maxVal</span><span class="p">,</span><span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">)</span>
    <span class="c"># Detect edges</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">Canny</span><span class="p">(</span><span class="n">bw</span><span class="p">,</span><span class="n">thCan1</span><span class="p">,</span><span class="n">thCan2</span><span class="p">,</span><span class="n">apertureSize</span><span class="o">=</span><span class="n">kerSizeCan</span><span class="p">)</span>
    <span class="c"># Dilate edges</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">kerSizeDil</span><span class="p">,</span><span class="n">I</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">dilate</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c"># Find longest line</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">HoughLinesP</span><span class="p">(</span><span class="n">dilate</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span><span class="n">thHou</span><span class="p">,</span><span class="n">minLineLength</span><span class="p">,</span><span class="n">maxLineGap</span><span class="p">)</span>
    <span class="n">maxL</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">((</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="o">-</span><span class="n">y2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">L</span> <span class="o">&gt;</span> <span class="n">maxL</span><span class="p">:</span>
                <span class="n">maxL</span> <span class="o">=</span> <span class="n">L</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x1</span>
    <span class="c"># Return data</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">dilate</span>


<span class="c"># inspired by: http://matplotlib.org/examples/widgets/buttons.html</span>
</div>
<div class="viewcode-block" id="SegmentUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI">[docs]</a><span class="k">class</span> <span class="nc">SegmentUI</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;*(deprecated)* Class for performing manual point feature extraction.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I : np.array</span>
<span class="sd">        Nf x Nr x Nc (frames number x image row size x image column size) array containing grey levels data.</span>
<span class="sd">        </span>
<span class="sd">    data : dict</span>
<span class="sd">        Dictionary when keys are frame values and values are list of tuples. Each tuple represents coordinates for a single point in the image.</span>
<span class="sd">    </span>
<span class="sd">    Nclicks : int</span>
<span class="sd">        Number of point features to be extracted.</span>
<span class="sd">        </span>
<span class="sd">    block : bool</span>
<span class="sd">        If to block the window or not.</span>
<span class="sd">        In interactive Python shell mode, if True, it shows the main window and disables buttons usage. These have to be called</span>
<span class="sd">        manually from command line. If False, program flow is interrupted until the main window is closed, and buttons usage is enabled.</span>
<span class="sd">        In script mode, if True, it has the same behaviour as interactive shell. In this mondality, False value has no meaning since no</span>
<span class="sd">        window is shown.</span>
<span class="sd">            </span>
<span class="sd">    title : str</span>
<span class="sd">        Window title</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{},</span> <span class="n">Nclicks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        
        <span class="c"># Set sttributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">I</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nclicks</span> <span class="o">=</span> <span class="n">Nclicks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c"># Create plot area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="c"># Crete current idx text</span>
        <span class="n">axidx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.065</span><span class="p">])</span>
        <span class="n">axidx</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axidx</span><span class="p">)</span>
        
        <span class="c"># Show first image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showImage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showPoints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showCurrentIdx</span><span class="p">()</span>
        
        <span class="c"># Define buttons</span>
        <span class="n">axclick</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axreset</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axfileload</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axfilesave</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axprev</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axnext</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">bclick</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axclick</span><span class="p">,</span> <span class="s">&#39;Click&#39;</span><span class="p">)</span>
        <span class="n">bclick</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">click</span><span class="p">)</span>
        <span class="n">breset</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axreset</span><span class="p">,</span> <span class="s">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="n">breset</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>
        <span class="n">bfileload</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axfileload</span><span class="p">,</span> <span class="s">&#39;Load...&#39;</span><span class="p">)</span>
        <span class="n">bfileload</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileLoad</span><span class="p">)</span>
        <span class="n">bfilesave</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axfilesave</span><span class="p">,</span> <span class="s">&#39;Save...&#39;</span><span class="p">)</span>
        <span class="n">bfilesave</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileSave</span><span class="p">)</span>
        <span class="n">bnext</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axnext</span><span class="p">,</span> <span class="s">&#39;Next&#39;</span><span class="p">)</span>
        <span class="n">bnext</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">)</span>
        <span class="n">bprev</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axprev</span><span class="p">,</span> <span class="s">&#39;Previous&#39;</span><span class="p">)</span>
        <span class="n">bprev</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev</span><span class="p">)</span>
        
        <span class="c"># Plot title</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        
        <span class="c"># Adjust borders</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>    
        
        <span class="c"># Plot</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
        
    
    <span class="k">def</span> <span class="nf">_showImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">,:,:]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        
<div class="viewcode-block" id="SegmentUI.next"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show next image.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Calculate index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showCurrentIdx</span><span class="p">()</span>
        <span class="c"># Replot image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showImage</span><span class="p">()</span>
        <span class="c"># Plot points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showPoints</span><span class="p">()</span>
        
</div>
<div class="viewcode-block" id="SegmentUI.prev"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI.prev">[docs]</a>    <span class="k">def</span> <span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show previous image.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Calculate index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showCurrentIdx</span><span class="p">()</span>
        <span class="c"># Replot image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showImage</span><span class="p">()</span>
        <span class="c"># Plot points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showPoints</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="SegmentUI.click"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI.click">[docs]</a>    <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Allow to click on ``Nclicks`` manually in the current image</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nclicks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showPoints</span><span class="p">()</span>
        
    </div>
<div class="viewcode-block" id="SegmentUI.reset"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the number of clicked points for the current image.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clearPoints</span><span class="p">()</span>
        
    </div>
    <span class="k">def</span> <span class="nf">_showPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;ro&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
        
    <span class="k">def</span> <span class="nf">_clearPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showImage</span><span class="p">()</span>
        
    
    <span class="k">def</span> <span class="nf">_showCurrentIdx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">))</span>
        
    
<div class="viewcode-block" id="SegmentUI.getData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get clicked points data.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            For the format, see ``data`` in the constructor method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    
    </div>
<div class="viewcode-block" id="SegmentUI.fileLoad"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI.fileLoad">[docs]</a>    <span class="k">def</span> <span class="nf">fileLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow to load points data from file, by a user dialog.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : param matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Select path</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c"># Load file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="c"># Plot points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_showPoints</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="SegmentUI.fileSave"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentUI.fileSave">[docs]</a>    <span class="k">def</span> <span class="nf">fileSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow to save points data to file, by a user dialog.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Select path</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>        
        <span class="c"># Save file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
        










</div></div>
<div class="viewcode-block" id="ViewerUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI">[docs]</a><span class="k">class</span> <span class="nc">ViewerUI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for visualization of 2D image frames.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    I : np.array</span>
<span class="sd">        Nf x Nr x Nc (frames number x image row size x image column size) array containing grey levels data.</span>
<span class="sd">        </span>
<span class="sd">    title : str</span>
<span class="sd">        Window title</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        
        <span class="c"># Set sttributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I</span> <span class="o">=</span> <span class="n">I</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">I</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c"># Create plot area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="c"># Crete current idx text</span>
        <span class="n">axidx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.065</span><span class="p">])</span>
        <span class="n">axidx</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axidx</span><span class="p">)</span>
        
        <span class="c"># Show first image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        
        <span class="c"># Define buttons</span>
        <span class="n">axprev</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axnext</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.81</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bnext</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axnext</span><span class="p">,</span> <span class="s">&#39;Next&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bnext</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bprev</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axprev</span><span class="p">,</span> <span class="s">&#39;Previous&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bprev</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev</span><span class="p">)</span>
        
        <span class="c"># Define index slider</span>
        <span class="n">axsliderInd</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.065</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderInd</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axsliderInd</span><span class="p">,</span> <span class="s">&#39;Frame&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderInd</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedInd</span><span class="p">)</span>
        
        <span class="c"># Plot title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        
        <span class="c"># Adjust borders</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>    
        
        
<div class="viewcode-block" id="ViewerUI.update"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show image and frame number.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showImage</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showCurrentIdx</span><span class="p">()</span>        
        
    </div>
<div class="viewcode-block" id="ViewerUI.showImage"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.showImage">[docs]</a>    <span class="k">def</span> <span class="nf">showImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show image for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="p">,:,:],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        </div>
<div class="viewcode-block" id="ViewerUI.next"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show next image.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : param matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Calculate index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        
</div>
<div class="viewcode-block" id="ViewerUI.prev"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.prev">[docs]</a>    <span class="k">def</span> <span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show previous image.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : param matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Calculate index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        
</div>
<div class="viewcode-block" id="ViewerUI.changedInd"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.changedInd">[docs]</a>    <span class="k">def</span> <span class="nf">changedInd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for frame index slider.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Set index</span>
        <span class="n">valIn</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;&gt;</span> <span class="n">valIn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sliderInd</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="n">val</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ind</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">J</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        
    </div>
<div class="viewcode-block" id="ViewerUI.showCurrentIdx"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.showCurrentIdx">[docs]</a>    <span class="k">def</span> <span class="nf">showCurrentIdx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show current frame number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">txt</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J</span><span class="p">))</span>
        
        </div>
<div class="viewcode-block" id="ViewerUI.showViewer"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.showViewer">[docs]</a>    <span class="k">def</span> <span class="nf">showViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show viewer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="ViewerUI.closeViewer"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerUI.closeViewer">[docs]</a>    <span class="k">def</span> <span class="nf">closeViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close viewer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="p">)</span>        


</div></div>
<div class="viewcode-block" id="ViewerWithFeaturesUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerWithFeaturesUI">[docs]</a><span class="k">class</span> <span class="nc">ViewerWithFeaturesUI</span><span class="p">(</span><span class="n">ViewerUI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for visualization of 2D image frames and image features.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *args</span>
<span class="sd">        See ``ViewerUI.__init__()``.</span>
<span class="sd">            </span>
<span class="sd">    **kwargs</span>
<span class="sd">        See ``ViewerUI.__init__()``.</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ViewerWithFeaturesUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span> <span class="o">=</span> <span class="bp">None</span>
    
<div class="viewcode-block" id="ViewerWithFeaturesUI.next"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerWithFeaturesUI.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show next image and features. See method ``ViewerUI.next()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ViewerWithFeaturesUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="ViewerWithFeaturesUI.prev"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerWithFeaturesUI.prev">[docs]</a>    <span class="k">def</span> <span class="nf">prev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show previous image and features. See class ``ViewerUI.prev()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ViewerWithFeaturesUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">prev</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="ViewerWithFeaturesUI.changedInd"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerWithFeaturesUI.changedInd">[docs]</a>    <span class="k">def</span> <span class="nf">changedInd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for frame index slider. See class ``ViewerUI.changedInd()``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ViewerWithFeaturesUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">changedInd</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="ViewerWithFeaturesUI.getData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.ViewerWithFeaturesUI.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return points data.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Points data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>


</div></div>
<div class="viewcode-block" id="SegmentPointsUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentPointsUI">[docs]</a><span class="k">class</span> <span class="nc">SegmentPointsUI</span><span class="p">(</span><span class="n">ViewerWithFeaturesUI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for visualization of 2D image frames and manually segmentable points.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Npoints : int</span>
<span class="sd">        Number of point features per image to be extracted. </span>
<span class="sd">        </span>
<span class="sd">    data : dict</span>
<span class="sd">        Dictionary when keys a frame values and values are list of tuples. Each tuple represents coordinates for a single point in the image.</span>
<span class="sd">    </span>
<span class="sd">    *args</span>
<span class="sd">        See ``ViewerWithFeaturesUI.__init__()``.</span>
<span class="sd">        </span>
<span class="sd">    **kwargs: </span>
<span class="sd">        - &#39;title&#39;: window title.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Npoints</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">SegmentPointsUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span> <span class="o">=</span> <span class="n">OptsPointsUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Npoints</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        

</div>
<div class="viewcode-block" id="MaskImageUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.MaskImageUI">[docs]</a><span class="k">class</span> <span class="nc">MaskImageUI</span><span class="p">(</span><span class="n">ViewerWithFeaturesUI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for visualization of 2D image frames and manually create a mask.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    maskParams : int</span>
<span class="sd">        masking parameters. See ``OptsMaskImageUI.__init__()``</span>
<span class="sd">        </span>
<span class="sd">    data : dict</span>
<span class="sd">        Dictionary when keys a frame values and values are 2D binary Numpy matrices representing masks.</span>
<span class="sd">        </span>
<span class="sd">    *args :</span>
<span class="sd">        See ``ViewerWithFeaturesUI.__init__()``.</span>
<span class="sd">        </span>
<span class="sd">    **kwargs : </span>
<span class="sd">        - &#39;title&#39;: window title.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maskParams</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">MaskImageUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span> <span class="o">=</span> <span class="n">OptsMaskImageUI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maskParams</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        
        
        
        </div>
<div class="viewcode-block" id="SegmentPointsHoughUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.SegmentPointsHoughUI">[docs]</a><span class="k">class</span> <span class="nc">SegmentPointsHoughUI</span><span class="p">(</span><span class="n">ViewerWithFeaturesUI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for visualization of 2D image frames and automatically segmentable points lying on a line.</span>
<span class="sd">    The images are supposed to have two areas of diffrent grays levels, divided by a single line.</span>
<span class="sd">    For the details on the automatic line detection algorithm, see function ``detectHoughLongestLine()``.</span>
<span class="sd">    Automatically detected points can be manually adjusted.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Npoints : int</span>
<span class="sd">        Number of point features per image to be extracted.</span>
<span class="sd">        </span>
<span class="sd">    autoSegParams : dict</span>
<span class="sd">        Dictionary where keys are parameter names for function ``detectHoughLongestLine()``.</span>
<span class="sd">        </span>
<span class="sd">    dataConstr : list</span>
<span class="sd">        List of constraints for each point. Each element is a dictionary that can contain the follwing fields:</span>
<span class="sd">        - &#39;xPct&#39;: this imposes the x coordinate of the point to be a perecentage of the image width.    </span>
<span class="sd">    </span>
<span class="sd">    data : dict</span>
<span class="sd">        Dictionary when keys a frame values and values are list of tuples. Each tuple represents coordinates for a single point in the image.</span>
<span class="sd">    </span>
<span class="sd">    *args:</span>
<span class="sd">        See ``ViewerWithFeaturesUI.__init__()``.</span>
<span class="sd">        </span>
<span class="sd">    **kwargs: </span>
<span class="sd">        - &#39;title&#39;: window title.</span>
<span class="sd">        - &#39;saveDataPath&#39;: existing folder path where to save automatically segmented images.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Npoints</span><span class="p">,</span> <span class="n">autoSegParams</span><span class="p">,</span> <span class="n">dataConstr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">SegmentPointsHoughUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">featuresUI</span> <span class="o">=</span> <span class="n">OptsPointsHoughUI</span><span class="p">(</span><span class="n">autoSegParams</span><span class="p">,</span> <span class="n">dataConstr</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">Npoints</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   
            
            
            
            
            </div>
<div class="viewcode-block" id="OptsPointsUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI">[docs]</a><span class="k">class</span> <span class="nc">OptsPointsUI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class adding manual points extraction capabilities to class ``ViewerUI`` or a derivate.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    viewer : ViewerUI</span>
<span class="sd">        Instance of class ``ViewerUI`` or a derivate.</span>
<span class="sd">        </span>
<span class="sd">    Npoints : int</span>
<span class="sd">        Number of point features per image to be extracted. </span>
<span class="sd">        </span>
<span class="sd">    data : dict</span>
<span class="sd">        Dictionary when keys a frame values and values are list of tuples. Each tuple represents coordinates for a single point in the image.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
            
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">Npoints</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npoints</span> <span class="o">=</span> <span class="n">Npoints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointsh</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">axclick</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bclick</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axclick</span><span class="p">,</span> <span class="s">&#39;Click&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bclick</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">click</span><span class="p">)</span>        
        
        <span class="n">axreset</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breset</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axreset</span><span class="p">,</span> <span class="s">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breset</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>
        
        <span class="n">axfileload</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfileload</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axfileload</span><span class="p">,</span> <span class="s">&#39;Load...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfileload</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileLoad</span><span class="p">)</span>
        
        <span class="n">axfilesave</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfilesave</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axfilesave</span><span class="p">,</span> <span class="s">&#39;Save...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfilesave</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileSave</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">showPoints</span><span class="p">()</span>

        

<div class="viewcode-block" id="OptsPointsUI.click"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.click">[docs]</a>    <span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Allow to click on ``Npoints`` points manually in the current image</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Npoints</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showPoints</span><span class="p">()</span>
        
    </div>
<div class="viewcode-block" id="OptsPointsUI.reset"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the number of clicked points for the current image.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearPoints</span><span class="p">()</span>
        
    </div>
<div class="viewcode-block" id="OptsPointsUI.showPoints"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.showPoints">[docs]</a>    <span class="k">def</span> <span class="nf">showPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show points on screen for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)):</span>
                <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s">&#39;ro&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pointsh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
</div>
<div class="viewcode-block" id="OptsPointsUI.clearPoints"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.clearPoints">[docs]</a>    <span class="k">def</span> <span class="nf">clearPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove points from screen for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointsh</span> <span class="o">&lt;&gt;</span> <span class="p">[]:</span>
            <span class="k">for</span> <span class="n">pointh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointsh</span><span class="p">:</span>            
                <span class="k">if</span> <span class="n">pointh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
                    <span class="n">pointh</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointsh</span> <span class="o">=</span> <span class="p">[]</span>
        
    </div>
    <span class="k">def</span> <span class="nf">updateData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
        
        
<div class="viewcode-block" id="OptsPointsUI.showData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.showData">[docs]</a>    <span class="k">def</span> <span class="nf">showData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Refresh the screen with the points for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">clearPoints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showPoints</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsUI.fileLoad"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.fileLoad">[docs]</a>    <span class="k">def</span> <span class="nf">fileLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow to load points data from file, by a user dialog.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Select path</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c"># Load file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">readFeaturesFile</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span>
        <span class="c"># Plot points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showPoints</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="OptsPointsUI.fileSave"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.fileSave">[docs]</a>    <span class="k">def</span> <span class="nf">fileSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow to save points data to file, by a user dialog.</span>
<span class="sd">        </span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Select path</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>        
        <span class="c"># Save file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
            
            </div>
<div class="viewcode-block" id="OptsPointsUI.getData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsUI.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return points data.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Points data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        
        
        
</div></div>
<div class="viewcode-block" id="OptsMaskImageUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI">[docs]</a><span class="k">class</span> <span class="nc">OptsMaskImageUI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class adding manual masking capabilities to class ``MaskImageUI`` or a derivate.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    viewer : ViewerUI</span>
<span class="sd">        Instance of class ``ViewerUI`` or a derivate.</span>
<span class="sd">        </span>
<span class="sd">    maskParams : int</span>
<span class="sd">        Dictionary for mask addition/creation:</span>
<span class="sd">        - &#39;selectorType&#39;: string indicating mask selector type: &#39;pen&#39;, &#39;lasso&#39;.</span>
<span class="sd">        - &#39;width&#39;: width, in pixels, for the selector.</span>
<span class="sd">        If the selector is a pen, this is the pen thickness.</span>
<span class="sd">        If the selector is a lasso, this is ignored.</span>
<span class="sd">        </span>
<span class="sd">    data : dict</span>
<span class="sd">        Dictionary when keys a frame values and values are 2D binary Numpy matrices representing masks.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
       
    <span class="c"># Some parts are inspired by: http://matplotlib.org/examples/event_handling/lasso_demo.html   </span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">maskParams</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span> <span class="o">=</span> <span class="n">maskParams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;add&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maskh</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="c"># Add other ui components</span>
        <span class="n">axsliderWidth</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderWidth</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axsliderWidth</span><span class="p">,</span> <span class="s">&#39;Size&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderWidth</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedWidth</span><span class="p">)</span>
        
        <span class="n">axradioType</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;selectorType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lasso&#39;</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">active</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radioType</span> <span class="o">=</span> <span class="n">RadioButtons</span><span class="p">(</span><span class="n">axradioType</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;Lasso&#39;</span><span class="p">,</span> <span class="s">&#39;Pen&#39;</span><span class="p">),</span> <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radioType</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedType</span><span class="p">)</span>
        
        <span class="n">axmode</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmode</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axmode</span><span class="p">,</span> <span class="s">&#39;Add&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmode</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axmode</span><span class="p">,</span> <span class="s">&#39;Remove&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bmode</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modeChange</span><span class="p">)</span>        
        
        <span class="n">axreset</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breset</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axreset</span><span class="p">,</span> <span class="s">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">breset</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>
        
        <span class="n">axfileload</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.09</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfileload</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axfileload</span><span class="p">,</span> <span class="s">&#39;Load...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfileload</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileLoad</span><span class="p">)</span>
        
        <span class="n">axfilesave</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfilesave</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axfilesave</span><span class="p">,</span> <span class="s">&#39;Save...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfilesave</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileSave</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;selectorType&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;pen&#39;</span><span class="p">,</span><span class="s">&#39;lasso&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">canvas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onPress</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">showMask</span><span class="p">()</span>
        

    <span class="k">def</span> <span class="nf">_postLasso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verts</span><span class="p">):</span>
        <span class="c"># Relsease and delele lasso</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lasso</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lasso</span>
        <span class="c"># Create empty mask</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">M</span>
        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">N</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="c"># Upsample vertices</span>
        <span class="n">vertsPath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span><span class="o">.</span><span class="n">interpolated</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">vertsPath</span><span class="o">.</span><span class="n">vertices</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>
        <span class="c"># Fill mask</span>
        <span class="n">idxR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">verts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">idxC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">verts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">idxR</span><span class="p">[</span><span class="n">idxR</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">idxC</span><span class="p">[</span><span class="n">idxC</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">idxR</span><span class="p">[</span><span class="n">idxR</span> <span class="o">&gt;=</span> <span class="n">M</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">idxC</span><span class="p">[</span><span class="n">idxC</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">idxR</span><span class="p">,</span> <span class="n">idxC</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;selectorType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;pen&#39;</span><span class="p">:</span>
            <span class="c"># Make dilation on mask</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">structure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">d</span><span class="p">,</span><span class="n">d</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">binary_dilation</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;selectorType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lasso&#39;</span><span class="p">:</span>
            <span class="n">xMin</span><span class="p">,</span> <span class="n">xMax</span> <span class="o">=</span> <span class="n">idxC</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">idxC</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">yMin</span><span class="p">,</span> <span class="n">yMax</span> <span class="o">=</span> <span class="n">idxR</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">idxR</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xMin</span><span class="p">,</span> <span class="n">xMax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yMin</span><span class="p">,</span> <span class="n">yMax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Np</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">xv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">yv</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">xv</span><span class="p">,</span><span class="n">yv</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">vertsPath</span><span class="o">.</span><span class="n">contains_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">points</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c"># Add/remove mask from current one if existing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">origMask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">origMask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">origMask</span> <span class="o">|</span> <span class="n">mask</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">origMask</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">origMask</span>
        <span class="c"># Assign new mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span> 
        <span class="c"># Show mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        
    <span class="k">def</span> <span class="nf">_onPress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">locked</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="c"># Check if lasso is dragged onto another axes</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">&lt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c"># Create lasso</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="p">,</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_postLasso</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;selectorType&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;pen&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lasso</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lasso</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">set_color</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="c"># Acquire a lock on the widget drawing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lasso</span><span class="p">)</span>
        
        
<div class="viewcode-block" id="OptsMaskImageUI.changedWidth"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.changedWidth">[docs]</a>    <span class="k">def</span> <span class="nf">changedWidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for width.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsMaskImageUI.changedType"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.changedType">[docs]</a>    <span class="k">def</span> <span class="nf">changedType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for selector type.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        label : str</span>
<span class="sd">            Current radiobutton label.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s">&#39;Lasso&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;selectorType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;lasso&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maskParams</span><span class="p">[</span><span class="s">&#39;selectorType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;pen&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>

        </div>
<div class="viewcode-block" id="OptsMaskImageUI.modeChange"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.modeChange">[docs]</a>    <span class="k">def</span> <span class="nf">modeChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Allow to toggle add or remove modality.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;del&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmode</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s">&#39;Remove&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;add&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bmode</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s">&#39;Add&#39;</span><span class="p">)</span>
            
    </div>
<div class="viewcode-block" id="OptsMaskImageUI.reset"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete the whole mask for current frame.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent </span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearMask</span><span class="p">()</span>
        
    </div>
<div class="viewcode-block" id="OptsMaskImageUI.showMask"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.showMask">[docs]</a>    <span class="k">def</span> <span class="nf">showMask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show mask on screen for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">maskRGBA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">M</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">maskRGBA</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">maskRGBA</span><span class="p">[:,:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="c"># semi-transparent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maskh</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">maskRGBA</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">M</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
</div>
<div class="viewcode-block" id="OptsMaskImageUI.clearMask"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.clearMask">[docs]</a>    <span class="k">def</span> <span class="nf">clearMask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove whoole mask from screen for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskh</span> <span class="o">&lt;&gt;</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maskh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maskh</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maskh</span> <span class="o">=</span> <span class="bp">None</span>
        
    </div>
    <span class="k">def</span> <span class="nf">updateData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
        
        
<div class="viewcode-block" id="OptsMaskImageUI.showData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.showData">[docs]</a>    <span class="k">def</span> <span class="nf">showData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Refresh the screen with the mask for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">clearMask</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showMask</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsMaskImageUI.fileLoad"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.fileLoad">[docs]</a>    <span class="k">def</span> <span class="nf">fileLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow to load masks data from file, by a user dialog.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Select path</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c"># Load file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="c"># Plot mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="OptsMaskImageUI.fileSave"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.fileSave">[docs]</a>    <span class="k">def</span> <span class="nf">fileSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Allow to save masks data to file, by a user dialog.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Select path</span>
        <span class="n">filePath</span> <span class="o">=</span> <span class="n">tkFileDialog</span><span class="o">.</span><span class="n">asksaveasfilename</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>        
        <span class="c"># Save file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
            
            </div>
<div class="viewcode-block" id="OptsMaskImageUI.getData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsMaskImageUI.getData">[docs]</a>    <span class="k">def</span> <span class="nf">getData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return masks data.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Masks data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
            
            
            
            </div></div>
<div class="viewcode-block" id="OptsPointsHoughUI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI">[docs]</a><span class="k">class</span> <span class="nc">OptsPointsHoughUI</span><span class="p">(</span><span class="n">OptsPointsUI</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class adding automatic (Hough transform) line segmentation capabilities to class ``ViewerUI`` or a derivate.</span>
<span class="sd">    The images are supposed to have two areas of diffrent grays levels, divided by a single line.</span>
<span class="sd">    For the details on the automatic line detection algorithm, see function ``detectHoughLongestLine()``.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    autoSegParams : dict</span>
<span class="sd">        Dictionary where keys are parameter names for function ``detectHoughLongestLine()``.</span>
<span class="sd">        </span>
<span class="sd">    dataConstr : list</span>
<span class="sd">        List of constraints for each point. Each element is a dictionary that can contain the follwing fields:</span>
<span class="sd">        - &#39;xPct&#39;: this imposes the x coordinate of the point to be a perecentage of the image width.    </span>

<span class="sd">    *args</span>
<span class="sd">        See ``OptsPointsUI.__init__()``.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
            
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">autoSegParams</span><span class="p">,</span> <span class="n">dataConstr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OptsPointsHoughUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        
        <span class="c"># Set segmentation parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span> <span class="o">=</span> <span class="n">autoSegParams</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataConstr</span> <span class="o">=</span> <span class="n">dataConstr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDataPath</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="s">&#39;saveDataPath&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveDataPath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;saveDataPath&#39;</span><span class="p">]</span>
        
        <span class="c"># Add other ui components</span>
        <span class="n">axslider1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThI</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider1</span><span class="p">,</span> <span class="s">&#39;Th&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thI&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThI</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedThI</span><span class="p">)</span>
        
        <span class="n">axslider2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThCan1</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider2</span><span class="p">,</span> <span class="s">&#39;ThC1&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thCan1&#39;</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThCan1</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedThCan1</span><span class="p">)</span>
        
        <span class="n">axslider3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThCan2</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider3</span><span class="p">,</span> <span class="s">&#39;ThC2&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thCan2&#39;</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThCan2</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedThCan2</span><span class="p">)</span>
        
        <span class="n">axslider4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeCan</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider4</span><span class="p">,</span> <span class="s">&#39;KerC&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;kerSizeCan&#39;</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeCan</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedKerSizeCan</span><span class="p">)</span>
        
        <span class="n">axslider5</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeDilV</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider5</span><span class="p">,</span> <span class="s">&#39;KerDv&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;kerSizeDil&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeDilV</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedKerSizeDilV</span><span class="p">)</span>
        
        <span class="n">axslider6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeDilH</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider6</span><span class="p">,</span> <span class="s">&#39;KerDh&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;kerSizeDil&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeDilH</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedKerSizeDilH</span><span class="p">)</span>
        
        <span class="n">axslider7</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThHou</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider7</span><span class="p">,</span> <span class="s">&#39;ThHou&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thHou&#39;</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderThHou</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedThHou</span><span class="p">)</span>
        
        <span class="n">axslider8</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderMinLineLength</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider8</span><span class="p">,</span> <span class="s">&#39;minL&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;minLineLength&#39;</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderMinLineLength</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedMinLineLength</span><span class="p">)</span>
        
        <span class="n">axslider9</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderMaxLineGap</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">axslider9</span><span class="p">,</span> <span class="s">&#39;maxGap&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">valinit</span><span class="o">=</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;maxLineGap&#39;</span><span class="p">],</span> <span class="n">valfmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%0.0f</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sliderMaxLineGap</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changedMaxLineGap</span><span class="p">)</span>
        
        <span class="n">axcreatepoints</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcreatepoints</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axcreatepoints</span><span class="p">,</span> <span class="s">&#39;Create points on line&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcreatepoints</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">autoCreatePoints</span><span class="p">)</span>
        
        <span class="c"># Automatically detect points for all frames</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">J</span><span class="p">):</span>
            <span class="c">#for i in range(0, 20):</span>
                <span class="c"># Segment line</span>
                <span class="k">print</span> <span class="s">&#39;Segmenting line for line </span><span class="si">%d</span><span class="s">/</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">J</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="n">i</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
                <span class="c"># Save images to folder</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveDataPath</span> <span class="o">&lt;&gt;</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">extent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">transformed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">dpi_scale_trans</span><span class="o">.</span><span class="n">inverted</span><span class="p">())</span>    <span class="c"># inspired by: http://stackoverflow.com/questions/4325733/save-a-subplot-in-matplotlib</span>
                    <span class="n">figPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveDataPath</span> <span class="o">+</span> <span class="s">&#39;/frame_</span><span class="si">%2d</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>      
                    <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figPath</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="n">extent</span><span class="o">.</span><span class="n">expanded</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>
        
        <span class="c"># Detect points for first frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        
        <span class="c"># Show data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        
<div class="viewcode-block" id="OptsPointsHoughUI.changedThI"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedThI">[docs]</a>    <span class="k">def</span> <span class="nf">changedThI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for image threshold slider.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedThCan1"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedThCan1">[docs]</a>    <span class="k">def</span> <span class="nf">changedThCan1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for Canny edge detector lower threshold.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thCan1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedThCan2"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedThCan2">[docs]</a>    <span class="k">def</span> <span class="nf">changedThCan2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for Canny edge detector higher threshold.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thCan2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
</div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedKerSizeCan"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedKerSizeCan">[docs]</a>    <span class="k">def</span> <span class="nf">changedKerSizeCan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for Canny edge detector Sobel kernel size.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valIn</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">3.5</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">3</span>    
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;&gt;</span> <span class="n">valIn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeCan</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;kerSizeCan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedKerSizeDilV"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedKerSizeDilV">[docs]</a>    <span class="k">def</span> <span class="nf">changedKerSizeDilV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for dilation kernel height.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valIn</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">3.5</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">3</span>    
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;&gt;</span> <span class="n">valIn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeDilV</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;kerSizeDil&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedKerSizeDilH"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedKerSizeDilH">[docs]</a>    <span class="k">def</span> <span class="nf">changedKerSizeDilH</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for dilation kernel width.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valIn</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mf">3.5</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">3</span>    
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;&gt;</span> <span class="n">valIn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sliderKerSizeDilH</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;kerSizeDil&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
</div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedThHou"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedThHou">[docs]</a>    <span class="k">def</span> <span class="nf">changedThHou</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for probabilistic Hough transform threshold.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;thHou&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedMinLineLength"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedMinLineLength">[docs]</a>    <span class="k">def</span> <span class="nf">changedMinLineLength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for probabilistic Hough transform minimum line length.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;minLineLength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>    
        
</div>
<div class="viewcode-block" id="OptsPointsHoughUI.changedMaxLineGap"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.changedMaxLineGap">[docs]</a>    <span class="k">def</span> <span class="nf">changedMaxLineGap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for probabilistic Hough transform maximum line gap.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            Current slider value.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">[</span><span class="s">&#39;maxLineGap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>  
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.autoCreatePoints"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.autoCreatePoints">[docs]</a>    <span class="k">def</span> <span class="nf">autoCreatePoints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create points on the automatically detected line.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        event : matplotlib.backend_bases.MouseEvent:</span>
<span class="sd">            Event thrown when clicking on connected button.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detectPoints</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>

        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.showData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.showData">[docs]</a>    <span class="k">def</span> <span class="nf">showData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="sd">&quot;&quot;&quot;Refresh the screen with line the points for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearLine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showLine</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OptsPointsHoughUI</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">showData</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.updateData"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.updateData">[docs]</a>    <span class="k">def</span> <span class="nf">updateData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Redetect automatically line and points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detectLine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detectPoints</span><span class="p">()</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.detectPoints"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.detectPoints">[docs]</a>    <span class="k">def</span> <span class="nf">detectPoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detect points on the line using the constraints.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Npoints</span><span class="p">):</span>
            <span class="n">constr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataConstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;xPct&#39;</span> <span class="ow">in</span> <span class="n">constr</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">constr</span><span class="p">[</span><span class="s">&#39;xPct&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">N</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.detectLine"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.detectLine">[docs]</a>    <span class="k">def</span> <span class="nf">detectLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Automatically detect the line.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="n">edges</span><span class="p">,</span> <span class="n">dilate</span> <span class="o">=</span> <span class="n">detectHoughLongestLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">I</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ind</span><span class="p">,:,:],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">autoSegParams</span><span class="p">)</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.clearLine"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.clearLine">[docs]</a>    <span class="k">def</span> <span class="nf">clearLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove line from screen for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span> <span class="o">&lt;&gt;</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span> <span class="o">=</span> <span class="bp">None</span>
        
        </div>
<div class="viewcode-block" id="OptsPointsHoughUI.showLine"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.OptsPointsHoughUI.showLine">[docs]</a>    <span class="k">def</span> <span class="nf">showLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show line on screen for current frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">N</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">x2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewer</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineh</span><span class="p">,</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">),(</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">),</span><span class="s">&#39;r-&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
        
        
        
        </div></div>
<div class="viewcode-block" id="readFeaturesFile"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.readFeaturesFile">[docs]</a><span class="k">def</span> <span class="nf">readFeaturesFile</span><span class="p">(</span><span class="n">filePath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Read feature file data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filePath : str</span>
<span class="sd">        Full file path for the features file.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        dictionary when keys are frame values and values contain features data.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
    
</div>
<div class="viewcode-block" id="singlePointFeaturesTo3DPointsMatrix"><a class="viewcode-back" href="../../api/api.html#Py3DFreeHandUS.segment.singlePointFeaturesTo3DPointsMatrix">[docs]</a><span class="k">def</span> <span class="nf">singlePointFeaturesTo3DPointsMatrix</span><span class="p">(</span><span class="n">fea</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">idx</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transform a single points features structures to matrix containing 3D</span>
<span class="sd">    points data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fea : dict</span>
<span class="sd">        Dictionary containing features data (see ``SegmentUI.__init__()``).</span>
<span class="sd">        </span>
<span class="sd">    u, v : float</span>
<span class="sd">        mm-to-pixel conversion factors (in *mm/pixel*) for horizontal and vertical coordinates.</span>
<span class="sd">        </span>
<span class="sd">    idx : list</span>
<span class="sd">        List of image frames number to be used. If None, all the available frames will be used.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    np.ndarray</span>
<span class="sd">        Np x 4 matrix, where Np is the number of pointt features used </span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fea</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">fea</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="p">,</span> <span class="n">fea</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">])</span>   <span class="c"># Np x 4</span>
    <span class="k">return</span> <span class="n">P</span>

            
        
        
<span class="c">#if __name__ == &#39;__main__&#39;:</span>
<span class="c">#    </span>
<span class="c">#    from image_utils import *</span>
<span class="c">#    D, ds = readDICOM(&#39;C:/Users/Davide Monari/Desktop/KULeuvenJob/PythonSoftware/Ultrasound/cam_phantom_dave/test5_cam_br_Mevis.dcm&#39;)</span>
<span class="c">#    I = pixelData2grey(D)</span>
<span class="c">#        </span>
<span class="c">#    parSeg = {}</span>
<span class="c">#    parSeg[&#39;thI&#39;] = 0.1</span>
<span class="c">#    parSeg[&#39;thCan1&#39;] = 50</span>
<span class="c">#    parSeg[&#39;thCan2&#39;] = 150</span>
<span class="c">#    parSeg[&#39;kerSizeCan&#39;] = 5</span>
<span class="c">#    parSeg[&#39;kerSizeDil&#39;] = [3, 3]</span>
<span class="c">#    parSeg[&#39;thHou&#39;] = 100</span>
<span class="c">#    parSeg[&#39;minLineLength&#39;] = 10</span>
<span class="c">#    parSeg[&#39;maxLineGap&#39;] = 10</span>
<span class="c">#    </span>
<span class="c">#    data = {}</span>
<span class="c">#    dataConstr = [{&#39;xPct&#39;:0.2},{&#39;xPct&#39;:0.8}]    </span>
<span class="c">#    </span>
<span class="c">#    #ui = SegmentPointsHoughUI(2, parSeg, dataConstr, data, I, title=&#39;The title&#39;, saveDataPath=&#39;C:/Users/Davide Monari/Desktop/KULeuvenJob/PythonSoftware/Ultrasound/cam_phantom_dave/figs&#39;)</span>
<span class="c">#    #ui = SegmentPointsUI(2, data, I, title=&#39;The title&#39;)  </span>
<span class="c">#    </span>
<span class="c">#    parMask = {}</span>
<span class="c">#    parMask[&#39;selectorType&#39;] = &#39;lasso&#39;</span>
<span class="c">#    parMask[&#39;width&#39;] = 5</span>
<span class="c">#    </span>
<span class="c">#    ui = MaskImageUI(parMask, data, I, title=&#39;The title&#39;)</span>
<span class="c">#    ui.showViewer()</span>
        
        
        
        
        
        </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Py3DFreeHandUS 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Davide Monari.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>